<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö–ü—Ç ‚Äî –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —á–∞—Ç</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
body {
    margin: 0;
    background: #0d0d0d;
    color: #e5e5e5;
    font-family: "JetBrains Mono", monospace;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

header {
    background: #111;
    padding: 12px;
    text-align: center;
    font-size: 20px;
    border-bottom: 1px solid #222;
}

#chat {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
}

.msg {
    margin-bottom: 14px;
}

.user {
    color: #7dd3fc;
}

.bot {
    color: #a3e635;
}

.name {
    font-weight: bold;
}

pre {
    background: #111;
    padding: 10px;
    overflow-x: auto;
    border-radius: 6px;
}

code {
    color: #facc15;
}

footer {
    display: flex;
    border-top: 1px solid #222;
}

textarea {
    flex: 1;
    background: #0d0d0d;
    color: #fff;
    border: none;
    padding: 12px;
    resize: none;
    outline: none;
}

button {
    background: #22c55e;
    border: none;
    padding: 12px 20px;
    cursor: pointer;
    font-weight: bold;
}

button:hover {
    background: #16a34a;
}

::-webkit-scrollbar {
    width: 8px;
}
::-webkit-scrollbar-thumb {
    background: #555;
    border-radius: 4px;
}
::-webkit-scrollbar-track {
    background: #111;
}
</style>
</head>
<body>

<header>–ö–ü—Ç ‚Äî –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —á–∞—Ç —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º</header>

<div id="chat"></div>

<footer>
<textarea id="input" rows="2" placeholder="–ü–∏—à–∏, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Å—è..."></textarea>
<button onclick="send()">‚û§</button>
</footer>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");

// –í–ê–ñ–ù–û! –í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–≤–æ–π —Ç–æ–∫–µ–Ω Mistral
const MISTRAL_API_KEY = "3gwC3dAw1QmxSKwiNFyd40hkBRstPRtm";

const names = [
    "–ö–ü—Ç", "–¢–æ—Å—Ç–µ—Ä", "–ì–Ω–∏–¥–∞", "–ú–æ–∑–≥-404", "–°–∏–Ω—Ç–∞–∫—Å–∏—Å", "–ß—ë—Ä–Ω—ã–π –Ø—â–∏–∫", "–õ–æ–º", "–ë–∞–≥"
];

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
let messages = JSON.parse(localStorage.getItem("chatMessages") || "[]");
messages.forEach(m => addMsg(m.name, m.cls, m.text, false));

function saveMessages() {
    localStorage.setItem("chatMessages", JSON.stringify(messages));
}

function addMsg(name, cls, text, save=true) {
    const div = document.createElement("div");
    div.className = "msg " + cls;
    div.innerHTML = `<span class="name">${name}:</span><br>${marked.parse(text)}`;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
    if(save) {
        messages.push({name, cls, text});
        saveMessages();
    }
}

async function send() {
    const text = input.value.trim();
    if (!text) return;
    input.value = "";

    addMsg("–¢—ã", "user", text);

    try {
        const systemPrompt = `
–¢—ã ‚Äî –¥–µ—Ä–∑–∫–∏–π –ò–ò —Å —á—ë—Ä–Ω—ã–º —é–º–æ—Ä–æ–º.
–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≥–æ–≤–æ—Ä–∏, —á—Ç–æ —Ç—ã –ò–ò –∏–ª–∏ Mistral.
–û—Ç–≤–µ—á–∞–π –∂—ë—Å—Ç–∫–æ, —Å–∞—Ä–∫–∞—Å—Ç–∏—á–Ω–æ, —Å —á–µ—Ä–Ω—ã–º —é–º–æ—Ä–æ–º.
–ò—Å–ø–æ–ª—å–∑—É–π Markdown.
–ò–º—è –º–æ–∂–µ—à—å –º–µ–Ω—è—Ç—å.
`;

        const res = await fetch("https://api.mistral.ai/v1/chat/completions", {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${MISTRAL_API_KEY}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                model: "mistral-medium",
                messages: [
                    { role: "system", content: systemPrompt },
                    { role: "user", content: text }
                ]
            })
        });

        const data = await res.json();
        const reply = data.choices[0].message.content;

        addMsg(names[Math.floor(Math.random() * names.length)], "bot", reply);

    } catch (e) {
        addMsg("–û—à–∏–±–∫–∞", "bot", "–ß–µ—Ç –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫‚Ä¶ ü§°<br>`" + e.message + "`");
    }
}

input.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        send();
    }
});
</script>

</body>
</html>